---
import PostCard from './PostCard.astro';
import type { CollectionEntry } from 'astro:content';

interface Props {
  posts: CollectionEntry<'posts'>[];
  lang?: 'en' | 'zh';
  basePath?: string;
}

const { posts, lang = 'en', basePath = '/blog' } = Astro.props;

// Sort posts by date descending
const sortedPosts = posts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// Group by year
const postsByYear = sortedPosts.reduce((acc, post) => {
  const year = post.data.date.getFullYear();
  if (!acc[year]) {
    acc[year] = [];
  }
  acc[year].push(post);
  return acc;
}, {} as Record<number, CollectionEntry<'posts'>[]>);

const years = Object.keys(postsByYear).map(Number).sort((a, b) => b - a);
---

<div class="space-y-12">
  {years.map(year => (
    <section>
      <h2 class="text-2xl font-bold text-muted mb-6">{year}</h2>
      <div class="space-y-4">
        {postsByYear[year].map(post => (
          <PostCard post={post} lang={lang} basePath={basePath} />
        ))}
      </div>
    </section>
  ))}
</div>
