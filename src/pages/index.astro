---
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import Header from "../components/Header.astro";
import ProfileCard from "../components/home/ProfileCard.astro";
import LatestPosts from "../components/home/LatestPosts.astro";
import LatestChannel from "../components/home/LatestChannel.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../consts";
import { fetchTelegramChannel, type TelegramPost } from "../utils/telegram";

// Enable SSR for fresh Telegram data
export const prerender = false;

// Fetch Telegram channel data with graceful fallback
let telegramPosts: TelegramPost[] | null = [];
try {
    const channel = await fetchTelegramChannel("SpaceRad_io");
    telegramPosts = channel.posts;
} catch (error) {
    console.error("Failed to fetch Telegram channel:", error);
}

// Set cache header
Astro.response.headers.set("Cache-Control", "public, max-age=300, stale-while-revalidate=30");
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body>
    <Header />
    <main class="page-shell">
      <div class="home-container">
        <!-- Profile Section -->
        <section>
          <ProfileCard />
        </section>

        <!-- Radio Station (Telegram Channel) -->
        <section>
          <LatestChannel posts={telegramPosts} />
        </section>

        <!-- Latest Posts -->
        <section>
          <LatestPosts />
        </section>
      </div>
    </main>
    <Footer />
  </body>
</html>

<style lang="scss">
  @use "../styles/tokens" as *;

  .home-container {
    display: flex;
    flex-direction: column;
    gap: var(--space-12);
    animation: fadeIn 0.6s ease-out;

    @include reduced-motion {
      animation: none;
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
