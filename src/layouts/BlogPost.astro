---
import BaseLayout from './BaseLayout.astro';
import FormattedDate from '../components/FormattedDate.astro';
import CusdisComments from '../components/CusdisComments.astro';
import { getLangFromUrl, t } from '../utils/i18n';

interface Props {
  title: string;
  date: Date;
  description?: string;
  tag?: string[];
  author?: string;
  image?: string;
  comment?: boolean;
}

const lang = getLangFromUrl(Astro.url);
const { title, date, description, tag = [], author = 'Jabriel', image, comment = true } = Astro.props;
---

<BaseLayout title={title} description={description || ''} image={image}>
  <article class="container py-8">
    <!-- Header -->
    <header class="mb-8">
      <h1 class="text-3xl md:text-4xl font-bold mb-4">{title}</h1>
      <div class="flex flex-wrap items-center gap-4 text-secondary text-sm">
        <span class="flex items-center gap-1">
          <span class="i-ph:calendar"></span>
          <FormattedDate date={date} lang={lang} />
        </span>
        <span class="flex items-center gap-1">
          <span class="i-ph:user"></span>
          {author}
        </span>
      </div>
      {tag.length > 0 && (
        <div class="flex flex-wrap gap-2 mt-4">
          {tag.map(t => (
            <a
              href={`${lang === 'zh' ? '/zh' : ''}/tags/${t.toLowerCase()}`}
              class="px-3 py-1 text-sm bg-surface border border-border rounded-full hover:border-accent transition-colors"
            >
              #{t}
            </a>
          ))}
        </div>
      )}
    </header>

    <!-- Content -->
    <div class="prose">
      <slot />
    </div>

    <!-- Comments -->
    {comment && (
      <section class="mt-16 pt-8 border-t border-border">
        <h2 class="text-xl font-semibold mb-6">
          {lang === 'zh' ? '评论' : 'Comments'}
        </h2>
        <CusdisComments
          pageId={Astro.url.pathname}
          pageTitle={title}
          lang={lang}
        />
      </section>
    )}
  </article>
</BaseLayout>
